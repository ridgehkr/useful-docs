# useAsync

`useAsync()` is a powerful utility for managing the state of asynchronous operations in React applications. It simplifies handling async functions, providing an easy way to track their execution status and either manually or immediately invoke them. It is a valuable tool for managing asynchronous operations in React applications by simplifying the process of tracking and executing asynchronous functions while providing clear states for loading, errors, and data.

## Usage

1. Make sure you have `@ridgehkr/useful` installed in your application. If not, you can get started by following the [installation instructions](/#getting-started).

2. Import `useAsync` for use in your component:

```tsx
import { useAsync } from '@ridgehkr/useful'
```

### Basic Usage

The primary purpose of `useAsync` is to manage an asynchronous function. It returns an object that provides information about the state of it and a function to execute it if not immediately invoked.

```tsx
const { data, loading, error, run } = useAsync(asyncFunction)
```

Where:

- **`data`** holds the result of the async function when it completes successfully or null if it hasn't been executed yet.
- **`loading`** is a boolean indicating whether the async function is currently running.
- **`error`** contains any error that occurs during the async function execution or null if no errors occurred.
- **`run`** is a function that triggers the execution of the async function.

[See the API Reference](#api-reference) for more details on these return values.

### Immediate Execution

By default, the async function passed to useAsync is executed immediately upon component render. You can control this behavior by passing a second argument to the hook.

```tsx
const { data, loading, error, run } = useAsync(asyncFunction, false)
```

Setting this argument to `false` means the async function will not run immediately, allowing you to trigger it manually using the `run` function.

### Accessing Async State

To access the state of your asynchronous operation, you can use the `data`, `loading`, and `error` properties as shown in the [basic usage example](#basic-usage). These values can be used in your component's render function to display loading spinners, error messages, or the fetched data.

```tsx
// Display "Loading…" if the asyncronous function has not yet resolved
if (loading) {
  return <div>Loading...</div>
}

// Display the error message that was caught from the asyncronous function
if (error) {
  return <div>Error: {error.message}</div>
}

// Data will be null if there was an error or if the function has yet to resolve
if (data) {
  // output data values here…
}
```

## API Reference

### Parameters

| Property            | Required             | Type                                       | Description                                                                                                                             |
| :------------------ | :------------------- | :----------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------- |
| **`asyncFunction`** | yes                  | [`AsyncFunction<T>`](#asyncfunctiont-type) | The asynchronous function that you want to manage. It must be a function that returns a Promise.                                        |
| **`immediate`**     | no (default: `true`) | `boolean`                                  | Determines whether the async function should run immediately upon component render or wait for manual execution using the run function. |

#### `AsyncFunction<T>` type

The `AsyncFunction<T>` type is a generic type that represents an asynchronous function that returns a Promise. It is defined as follows:

```tsx
type AsyncFunction<T> = () => Promise<T>
```

### Return Value

The `useAsync` hook returns an object with the following values:

| Property      | Type                                                 | Description                                                                                             |
| :------------ | :--------------------------------------------------- | :------------------------------------------------------------------------------------------------------ |
| **`data`**    | [`AsyncFunction<T>`](#asyncfunctiont-type) or `null` | The result of the async function when it completes successfully or null if it hasn't been executed yet. |
| **`loading`** | `boolean`                                            | Whether the async function is currently awaiting resolution.                                            |
| **`error`**   | `unknown` or `null`                                  | Contains any error that occurs during the async function execution or `null` if no errors occurred.     |
| **`run`**     | `() => void`                                         | A function that triggers the execution of the async function.                                           |

## Examples

### Example 1: Basic Usage

In this example, the `fetchData` function is executed immediately upon component render. The `loading` state is true while the function is running, and the `data` state is updated with the result of the function when it completes successfully.

```tsx filename="App.jsx"
import React from 'react'
import { useAsync } from '@ridgehkr/useful'

function App() {
  const fetchData = async () => {
    const response = await fetch('https://api.example.com/data')
    return response.json()
  }

  const { data, loading, error, run } = useAsync(fetchData)

  return (
    <div>
      <button onClick={run}>Fetch Data</button>
      {loading && <p>Loading...</p>}
      {error && <p>Error: {error.message}</p>}
      {data && <p>Data: {data}</p>}
    </div>
  )
}
```

### Example 2: Manual Execution

Because the `immediate` flag is false, the asynchronous function `fetchData` will not run immediately upon component render. Instead, it will wait for the `run` function to be called:

```tsx filename="App.jsx"
import React from 'react'
import { useAsync } from '@ridgehkr/useful'

function App() {
  const fetchData = async () => {
    const response = await fetch('https://api.example.com/data')
    return response.json()
  }

  const { data, loading, error, run } = useAsync(fetchData, false)

  return (
    <div>
      <button onClick={run}>Fetch Data</button>
      {loading && <p>Loading...</p>}
      {error && <p>Error: {error.message}</p>}
      {data && <p>Data: {data}</p>}
    </div>
  )
}
```

## Tips

- Ensure that the `asyncFunction` passed to `useAsync` is an asynchronous function that returns a Promise.
- Use the `loading`, `error`, and `data` states to provide user feedback during the asynchronous operation.
- Consider using the `immediate` flag to control when the async function executes, depending on your use case.
